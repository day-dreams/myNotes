最近在写数据库的轮子,当前正处于写CS模型的阶段,发现有很多问题没有透彻的了解,写出来的CS不理想,所以重新学习一遍TCP协议.

全部内容来自与TCP/IP协议详解卷一:协议.

<!-- TOC -->

- [1. TCP初步](#1-tcp初步)
    - [1.1. TCP的必要性](#11-tcp的必要性)
        - [1.1.1. 根本问题：信道不可靠](#111-根本问题信道不可靠)
        - [1.1.2. 接受方是否已经接受到分组？](#112-接受方是否已经接受到分组)
        - [1.1.3. 接受方收到的分组是不是和发送方发出去的一样？](#113-接受方收到的分组是不是和发送方发出去的一样)
        - [1.1.4. 如果控制发送数据包的速率？](#114-如果控制发送数据包的速率)
    - [1.2. 一些可以解决问题的概念](#12-一些可以解决问题的概念)
        - [1.2.1. 分组窗口，滑动窗口](#121-分组窗口滑动窗口)
        - [1.2.2. 变量窗口：流量控制，拥塞控制](#122-变量窗口流量控制拥塞控制)
        - [1.2.3. 超时重传](#123-超时重传)
- [2. TCP连接管理](#2-tcp连接管理)
- [3. TCP超时与重传](#3-tcp超时与重传)
- [4. TCP数据流与窗口管理](#4-tcp数据流与窗口管理)
- [5. TCP拥塞控制](#5-tcp拥塞控制)
- [6. TCP保活机制](#6-tcp保活机制)

<!-- /TOC -->

# 1. TCP初步

## 1.1. TCP的必要性

这里列举一些问题，以说明引入TCP协议的重要性。
### 1.1.1. 根本问题：信道不可靠

在巨大的网络系统中，有一个致命问题：信道不可靠。也就是说，你不知道当前的设施能不能帮你完成数据传输。对于可能出现的差错(丢包，重复包，被修改了的差错包)，我们有两种方法来解决：使用差错校验码来纠正通信问题，自动重复请求(Automatic Repeat Request)。

### 1.1.2. 接受方是否已经接受到分组？
### 1.1.3. 接受方收到的分组是不是和发送方发出去的一样？
### 1.1.4. 如果控制发送数据包的速率？

## 1.2. 一些可以解决问题的概念

### 1.2.1. 分组窗口，滑动窗口

首先，我们把要传输的数据进行分组，每个分组都有一个序列号。传输数据端和接受数据端各自维护一个窗口结构。

通过这个窗口，两端可以看到三种分组：已经发送且确认的分组，正在发送的分组(正在等待确认，或正在发送)，尚未发送的分组。这样的窗口就是**分组窗口**。

随着数据的流动，一个又一个分组被发送且确认，窗口也在移动：它将显示新的三种分组，三种分组在向已经发送且确认的方向移动。这就是**滑动窗口**。

### 1.2.2. 变量窗口：流量控制，拥塞控制

上面提到的滑动窗口只存在位置的移动，可以跟踪整个数据流，但并没有说明数据流的速度。一个合理的传输速率，可以充分发挥发送端/接受端的性能。

当接受方的处理速度跟不上发送方，只有降低发送方的传输速率。这就是所谓的**流量控制**。流量控制有两种方法：

* 基于速率，即限制发送方的速率
* 基于窗口更新，即两端协商后决定窗口的大小，协商出一个处理速率

经过窗口更新后，双方会调整窗口大小，事双方都不至于跟不上速率。但是，中间网络可能出现差错：网络链路速度低，路由器内存不足等。所以还需要顾及到中间网络的能力，否则可能会导致丢包问题。解决这个问题的方法称为**拥塞控制**。

### 1.2.3. 超时重传

TCP协议是基于重传的，可以用来解决某些数据包丢失的问题。那么，怎么区分丢失的包和往返时间长的包？

从发送放到接受方再到发送放的往返时间(Round Trip Time，RTT)是不确定的，随着真实的网络情况而波动。我们需要一个RTT值来区分丢失的包和往返时间稍长的包，这个值一般是基于统计的。

如果RTT太大，会导致网络空间变得空闲，降低网络吞吐量;如果RTT太小，会导致重发的包太多，使网络空间十分拥挤。

# 2. TCP连接管理

# 3. TCP超时与重传

# 4. TCP数据流与窗口管理

# 5. TCP拥塞控制

# 6. TCP保活机制